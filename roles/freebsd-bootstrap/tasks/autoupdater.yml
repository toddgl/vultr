---
- name: Upgrade pkg
  tags: pkg-upgrade
  become: true
  community.general.pkgng:
    name: pkg
    state: latest

- name: Register installed packages
  ansible.builtin.shell: pkg info -q
  register: installed_packages

# - name: show installed packages
#  vars:
#    package_names: "{{ installed_packages.stdout_lines | map('regex_replace', '^(.*)-[^-]+$', '\\1') | list }}"
#  debug:
#    #msg: "packages {{ installed_packages.stdout_lines }}"
#    msg: 'package names {{ package_names }}'

- name: Upgrade all packages
  tags: pkg-upgrade
  become: true
  community.general.pkgng:
    name: "{{ installed_packages.stdout_lines | map('regex_replace', '^(.*)-[^-]+$', '\\1') | list }}"
    state: latest
