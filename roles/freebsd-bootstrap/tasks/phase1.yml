---
- name: Install python
  ansible.builtin.raw: sh -c "ASSUME_ALWAYS_YES=yes pkg install python"

- name: Install sudo
  community.general.pkgng: name=sudo

- name: Create admin user
  ansible.builtin.user: name={{ bootstrap_username }}

- name: Disable admin password
  ansible.builtin.command: pw user mod {{ bootstrap_username }} -w no

- name: Give sudo
  ansible.builtin.lineinfile:
  dest: /usr/local/etc/sudoers
  line: "{{ bootstrap_username }}    ALL=(ALL)    NOPASSWD: ALL"

- name: Allow ttyless sudo
  ansible.builtin.lineinfile:
  dest: /usr/local/etc/sudoers
  regexp: requiretty
  state: absent

- name: SSH key
  ansible.posix.authorized_key:
    user: "{{ bootstrap_username }}"
    key: "{{ lookup('file', bootstrap_sshkey) }}"
